{% extends "base.html" %}

{% block title %}‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£ - {{ application.candidate.first_name }} {{ application.candidate.last_name }}{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('main.dashboard') }}">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('jobs.company_applications') }}">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</a></li>
                    <li class="breadcrumb-item active" aria-current="page">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</li>
                </ol>
            </nav>
            
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1><i class="fas fa-user-check text-primary"></i> ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h1>
                    <p class="text-muted mb-0">‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà #{{ application.id }}</p>
                </div>
                <div>
                    <a href="{{ url_for('jobs.company_applications') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ -->
        <div class="col-md-8">
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5><i class="fas fa-user"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</strong><br>
                            {{ application.candidate.first_name }} {{ application.candidate.last_name }}</p>
                            
                            <p><strong>‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</strong><br>
                            <code>{{ application.candidate.candidate_id }}</code></p>
                            
                            <p><strong>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</strong><br>
                            <a href="mailto:{{ application.candidate.email }}" class="text-decoration-none">
                                <i class="fas fa-envelope text-primary"></i> {{ application.candidate.email }}
                            </a></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤:</strong><br>
                            <span class="badge bg-{{ 'info' if application.candidate.status == '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤' else 'primary' }} fs-6">
                                <i class="fas fa-{{ 'book' if application.candidate.status == '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤' else 'graduation-cap' }}"></i>
                                {{ application.candidate.status }}
                            </span></p>
                            
                            <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</strong><br>
                            {{ application.application_date.strftime('%d/%m/%Y ‡πÄ‡∏ß‡∏•‡∏≤ %H:%M ‡∏ô.') }}</p>
                            
                            <p><strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</strong><br>
                            <span class="text-muted">{{ application.candidate.additional_info or '‡πÑ‡∏°‡πà‡∏°‡∏µ' }}</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô -->
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h5><i class="fas fa-briefcase"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</strong><br>
                            {{ application.job.job_title }}</p>
                            
                            <p><strong>‡∏£‡∏´‡∏±‡∏™‡∏á‡∏≤‡∏ô:</strong><br>
                            <code>{{ application.job.job_id }}</code></p>
                            
                            <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô:</strong><br>
                            <span class="badge bg-{{ 'success' if application.job.job_type == '‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥' else 'warning' }} fs-6">
                                <i class="fas fa-{{ 'briefcase' if application.job.job_type == '‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥' else 'graduation-cap' }}"></i>
                                {{ application.job.job_type }}
                            </span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</strong><br>
                            <span class="badge bg-{{ 'success' if application.job.status == '‡πÄ‡∏õ‡∏¥‡∏î' else 'secondary' }} fs-6">
                                {{ application.job.status }}
                            </span></p>
                            
                            <p><strong>‡∏ß‡∏±‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</strong><br>
                            {{ application.job.application_deadline.strftime('%d/%m/%Y') }}
                            {% if application.job.application_deadline < application.application_date.date() %}
                                <br><small class="text-danger">‚ö†Ô∏è ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</small>
                            {% endif %}</p>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-12">
                            <p><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô:</strong></p>
                            <div class="bg-light p-3 rounded">
                                {{ application.job.job_description }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå -->
            <div class="card mb-4">
                <div class="card-header bg-warning text-dark">
                    <h5><i class="fas fa-shield-alt"></i> ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</h5>
                </div>
                <div class="card-body">
                    {% set is_eligible = true %}
                    
                    {% if application.job.job_type == '‡∏™‡∏´‡∏Å‡∏¥‡∏à‡∏®‡∏∂‡∏Å‡∏©‡∏≤' and application.candidate.status != '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤' %}
                        {% set is_eligible = false %}
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå:</strong> ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏™‡∏´‡∏Å‡∏¥‡∏à‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤"
                        </div>
                    {% elif application.job.job_type == '‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥' and application.candidate.status != '‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß' %}
                        {% set is_eligible = false %}
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå:</strong> ‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß"
                        </div>
                    {% else %}
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i>
                            <strong>‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå:</strong> ‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô
                        </div>
                    {% endif %}
                    
                    {% if application.job.application_deadline < application.application_date.date() %}
                        <div class="alert alert-warning">
                            <i class="fas fa-clock"></i>
                            <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5><i class="fas fa-cogs"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h5>
                </div>
                <div class="card-body">
                    <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong></p>
                    <div class="text-center mb-3">
                        <span class="badge bg-{% if application.status == '‡∏£‡∏≠‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤' %}warning{% elif application.status == '‡∏ú‡πà‡∏≤‡∏ô' %}success{% elif application.status == '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô' %}danger{% else %}secondary{% endif %} fs-5 p-3">
                            {% if application.status == '‡∏£‡∏≠‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤' %}
                                <i class="fas fa-clock"></i>
                            {% elif application.status == '‡∏ú‡πà‡∏≤‡∏ô' %}
                                <i class="fas fa-check-circle"></i>
                            {% elif application.status == '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô' %}
                                <i class="fas fa-times-circle"></i>
                            {% endif %}
                            {{ application.status }}
                        </span>
                    </div>

                    <form method="POST" action="{{ url_for('jobs.update_application_status', application_id=application.id) }}">
                        <div class="mb-3">
                            <label for="status" class="form-label">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</label>
                            <select class="form-select" id="status" name="status" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà</option>
                                <option value="‡∏£‡∏≠‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤" {% if application.status == '‡∏£‡∏≠‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤' %}selected{% endif %}>
                                    üïê ‡∏£‡∏≠‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤
                                </option>
                                <option value="‡∏ú‡πà‡∏≤‡∏ô" {% if application.status == '‡∏ú‡πà‡∏≤‡∏ô' %}selected{% endif %}>
                                    ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                                </option>
                                <option value="‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô" {% if application.status == '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô' %}selected{% endif %}>
                                    ‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                                </option>
                            </select>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                            </button>
                        </div>
                    </form>

                    <hr>

                    <div class="d-grid gap-2">
                        <a href="mailto:{{ application.candidate.email }}?subject=‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô {{ application.job.job_title }}&body=‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏Ñ‡∏∏‡∏ì{{ application.candidate.first_name }}%0A%0A‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á {{ application.job.job_title }}%0A%0A‡∏Ç‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏±‡∏ö‡∏ñ‡∏∑‡∏≠%0A{{ current_user.company.company_name }}" 
                           class="btn btn-outline-primary">
                            <i class="fas fa-envelope"></i> ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ñ‡∏∂‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£
                        </a>
                        
                        <a href="{{ url_for('jobs.job_detail', job_id=application.job.job_id) }}" 
                           class="btn btn-outline-info">
                            <i class="fas fa-eye"></i> ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô
                        </a>
                    </div>
                </div>
            </div>

            <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ -->
            <div class="card mt-4">
                <div class="card-header">
                    <h6><i class="fas fa-chart-bar"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h6>
                </div>
                <div class="card-body">
                    <small>
                        <p><strong>ID ‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</strong> #{{ application.id }}</p>
                        <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</strong><br>
                        {{ application.application_date.strftime('%d/%m/%Y %H:%M ‡∏ô.') }}</p>
                        <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong><br>
                        {{ application.status }}
                        </p>
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}